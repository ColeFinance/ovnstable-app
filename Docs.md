# Ядро системы

Overnight - это протокол DeFi, основанный на USD+, stablecoin с ежедневной выплатой прибыли.

### UsdPlusToken (USD+)

Основной токен протокола. ERC20. Rebased Stablecoin. Содержит индекс ликвидности, отражающий текущее отношение количества выпущенных 
USD+ токенов к объему активов на `Vault`, выраженному в USDC. Внутри балансы хранятся в RAY (используется `WadRayMath`), что позволяет 
не беспокоиться о точности работы с балансами при mint/redeem/balanceOf. Корректировка индекса ликвидности происходит при запуске процесса
выплат на `Exchange.payout()` от имени `Exchange`. Доступ к `mint()` и `redeem()` доступна только `Exchange`.

### Exchange 

Основная точка входа для клиентов.

Содержит три метода, доступных для внешнего вызова без модификаторов доступа: 
- buy - позволяет клиенту передать USDC и получить в обмен USD+. Полученные USDC передаются на `PortfolioManager`, где будет запущен механизм по вкладыванию, 
  полученных активов по заданным стратегиям. Может запустить процесс перераспределния вознаграждений `payout()`, 
  если в течение указанного промежутка времени он не выполнялся.
- redeem - позволяет клиенту обменять свои USD+ обратно на USDC. При необходимости запускается процесс на `PortfolioManager`, 
  где происходит изымание необходимого для возврата объема USDC. В случае проседания портфеля вкладов и снижения уровня обеспечения 
  ниже критического порога клиент может получить пропорциональную долю активов с `Vault`. Может запустить процесс перераспределения 
  вознаграждений `payout()`, если в течение указанного промежутка времени он не выполнялся.
- payout - позволяет запустить расчёт и выплату вознаграждений для всех держателей USD+. Производится получение доходов по стратегиям, 
  после чего корректируется индекс ликвидности на `UsdPlusToken` относительно объема активов на `Vault`.

### Portfolio

Содержит информацию по активам и весам. 
Веса `assetWeights` определяют целевые объемы активов на `Vault`. 
Информация о активах `assetInfos` содержит ссылку на `PriceGetter`, в котором можно получить эквивалентную стоимость в USDC для соответвующего актива.

### Balancer

Содержит логику для балансировки. На основе информации из `MarkToMarket` о текущем распределении активов и необходимости произвести корректировку
выстраивает цепочку необходимых действий по обмену активов между собой для достижения целевых объемов активов, заданных в `Portfolio`.

### Mark2Market

Предоставляет функционал получения информации о текущих активах на `Vault` и их стоимости в USDC. 
Информацию о стоимости каждого актива в USDC получает из соответствующего активу `PriceGetter`. 

Имеет слудующие общедоступные методы:
- assetPrices - получение сводной таблицы по стоимости текущих активов и общую стоимость активов в USDC на `Vault`
- totalUsdcPrice - общаю стоимость активов в USDC на `Vault`
- assetPricesForBalance - медод дял внутренних потребности, подготавливает информацию о разнице текущего объема активов и целевым показателем

### RewardManager

Содержит логику получение вознаграждений из протоколов, в которых находятся активы.

### Vault

Является держателем всех активов. Позволяет `PortfolioManaget` от своего имени выполнять действия с активами. Поддерживает работу только с ERC20 токенами.

### PortfolioManager

Содержит логику по управлению активами.
Принимает решение о балансировки портфеля. При запуске процесса балансировки получает от `Balancer` набор действий, позволяющий достичь 
целевых показателей по объемам активов на `Vault`. Исполняет указанные действия на `TokenExchange` от своего имени, распоряжась активами `Vault`.

### Connectors 

Коннекторы к протоколам, в которые вкладываются активы.
Содержат логику по stake/unstake специфичные, для каждого из протоколов.

### PriceGetter

Набор контрактов, содержащих в себе логику получения стоимости в USDC при операциях продажи/покупки соответствующего актива.

### TokenExchange

Набор контрактов, содержащих логику обмена пар активов между собой. Содержит один общедоступный метод `execute`, позволяющий произвести обмен.


# Управление (governance)

Модуль системы, который содержит логику для организации DAO.

### OvnGovernor

Основной контракт, который содержит логику управления.
Дает возможность вносить предложения на изменения протокола, контролирует процесс голосования.

За основу взят код от: openzeppelin

### GovToken (OVN)

Governance токен, который позволяет носителям участвовать в управление.

За основу взят код от: openzeppelin

### TimelockController 

Занимается выполнением предложений, которые успешно прошли голосование в OvnGovernor.
Является владельцем (owner) всех остальных контрактов системы.

За основу взят код от: openzeppelin
